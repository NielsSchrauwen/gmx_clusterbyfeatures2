.. |kmeans| raw:: html

   <a href="https://en.wikipedia.org/wiki/K-means_clustering" target="_blank">K-means clustering</a>

.. |DBSCAN| raw:: html

   <a href="https://en.wikipedia.org/wiki/DBSCAN" target="_blank">DBSCAN - Density-based spatial clustering of applications with noise</a>

.. |gmixture| raw:: html

   <a href="https://en.wikipedia.org/wiki/Mixture_model" target="_blank">Gaussian mixture model clustering</a>

.. |elbow| raw:: html

   <a href="https://en.wikipedia.org/wiki/Elbow_method_(clustering)" target="_blank">Elbow method</a>

.. |DBI| raw:: html

  <a href="https://en.wikipedia.org/wiki/Davies%E2%80%93Bouldin_index" target="_blank">DBI : Daviesâ€“Bouldin index</a>

.. |xmgrace| raw:: html

  <a href="http://plasma-gate.weizmann.ac.il/Grace/" target="_blank">Grace</a>

.. |sklearn| raw:: html

  <a href="http://scikit-learn.org" target="_blank">scikit-learn</a>

.. |overview-clustering| raw:: html

  <a href="http://scikit-learn.org/stable/modules/clustering.html#overview-of-clustering-methods" target="_blank">here</a>

.. |kmeans-detail| raw:: html

  <a href="http://scikit-learn.org/stable/modules/clustering.html#k-means" target="_blank">here</a>

.. |dbscan-detail| raw:: html

  <a href="http://scikit-learn.org/stable/modules/clustering.html#dbscan" target="_blank">here</a>

.. |gmixture-detail| raw:: html

  <a href="http://scikit-learn.org/stable/modules/mixture.html#mixture" target="_blank">here</a>



Command line options
====================

Options to specify input files
------------------------------

``-f [<.xtc/.trr/...>]``
~~~~~~~~~~~~~~~~~~~~~~~~
Input trajectory file of ``xtc`` ``trr`` ``cpt`` ``gro`` ``g96`` ``pdb`` or
``tng`` format.

.. note:: If this file is not provided, only clustering will be performed. No
          operations will be performed that require trajectory such as RMSD
          calculation, central structure calculations, clustered trajectories
          etc.

.. note:: In case of **XTC** and **TNG** formats, writing central structures and
          clustered trajectories are relatively fast.

******

``-s [<.tpr/.gro/...>]``
~~~~~~~~~~~~~~~~~~~~~~~~
An input structure file of ``tpr`` ``gro`` ``g96`` or ``pdb`` format. It is **required**
if trajectory is given as input.

******

``-n [<.ndx>]``
~~~~~~~~~~~~~~~
If given, index groups from this file will be prompted for selection. Otherwise,
default index groups will be prompted for selection.

This file will be ignored when no trajectory file will be provided.

Users will be prompted for three index group
  * **Choose a group for the output:** Select a index group to output it as central
    structure and clustered trajectory. It can be whole system or any part of the
    system.
  * **Choose a group for clustering/RMSD calculation:** The actual atom groups for
    which clustering has to be done and RMSD has to be calculated.
    .. note :: If you are doing PCA based clustering, it should be same first
    index group as selected in ``gmx covar`` and ``gmx anaeig``.
  * **Choose a group for fitting or superposition:** The atom groups used for
    fitting or superposition before RMSD calculation.

    .. note:: This input will be only prompted when ``-fit`` or ``-fit2central``
              option is given. Otherwise, group selected above will be used for
              fitting.

    .. note :: If you are doing PCA based clustering, it should be same as first
               index group selected in ``gmx covar`` and ``gmx anaeig``.

******

``-feat [<.xvg>]``
~~~~~~~~~~~~~~~~~~

It accepts a file containing features of trajectory as a function of time.
Its format is similar to the projections file generated by ``gmx anaeig``.
Therefore, in case of PCA data, output (``-proj``) of ``gmx anaeig`` can be
directly used as input for gmx_clusterByFeatures.

In this file, two columns should be present. First column is time and second column
is feature values. Each time-feature columns should be separated by "&".

The format is as following:

::

 # FEATURE - 1
 # Time    values
 0.0     123.12
 10.0    123.12
 20.0    123.12
 .
 .
 .

 &

 # FEATURE - 2
 0.0     123.12
 10.0    123.12
 20.0    123.12
 .
 .
 .

 &

 # FEATURE - 3
 0.0     123.12
 10.0    123.12
 20.0    123.12
 .
 .
 .

 &


.. note:: If this file is not provided, ``-clid [<.xvg>]`` is the required option.

******

Options to specify output files
-------------------------------

``-clid [<.xvg>]``
~~~~~~~~~~~~~~~~~~

It can be both **input** and **output** file. It contains two columns, first column
is time and second column is cluster label/id.

In default case when clustering has to be done, it is generated after clustering is
finished and contains information about cluster id of each frame.

However, it can be also given as input to obtain clustered trajectories. For example,
if clustering was performed with "gmx cluster", the obtained ``-clid [<.xvg>]``
file can be used here to extract clustered trajectory.

.. note:: To treat this as an input file, do not use ``-feat [<.xvg>]`` option.

******

``-g [<.log>]``
~~~~~~~~~~~~~~~

It is output log file and contains several information about clustering methods
and obtained results.

******

``-fout [<.xtc/.trr/...>]``
~~~~~~~~~~~~~~~~~~~~~~~~~~~

Output clustered trajectories. Separate trajectory of clusters is written for
convenience. These separate trajectories can be used for further analysis.

Each trajectory file name is suffixed by its respective cluster-id.

******

``-cpdb [<.pdb>]``
~~~~~~~~~~~~~~~~~~

Output separate pdb files for central structures of each cluster.

Each pdb file name is suffixed by its respective cluster-id.

******

``-rmsd [<.xvg>]``
~~~~~~~~~~~~~~~~~~

RMSD of clustering atom groups with respect to central structure.

Each RMSD file name is suffixed by its respective cluster-id.

******

Other options
-------------

``-xvg  <keyword>``
~~~~~~~~~~~~~~~~~~~

It directs the formatting of all output <.xvg> files. By default, <.xvg> files are
in ``xmgrace`` format, which can be plotted using |xmgrace| (``xmgrace`` command).

To plot with any other program, use ``-xvg none`` then a plain text file is
obtained.

******

``-method <keyword>``
~~~~~~~~~~~~~~~~~~~~~

Method to use for clustering. All the methods used here are used from
Python |sklearn| library.

An overview on clustering method are presented |overview-clustering|.

kmeans, dbscan, gmixture

Presently following methods are implemented:
  1. ``-method kmeans``

     |kmeans|- It needs cluster number as input (``-ncluster <int>``).
     Therefore, one should know beforehand how many cluster is there in data.
     To automatically determine the cluster number, :ref:`cmdline:-cmetric \<keyword\>`
     For more details about k-means method, see |kmeans-detail|.

  2. ``-method dbscan``

     |DBSCAN| - It does not require cluster number beforehand.
     The clusters are controlled by two other input options:
     :ref:`cmdline:-db_eps \<real\>` and :ref:`cmdline:-db_min_samples \<int\>`.
     For more details about DBSCAN method, see |dbscan-detail|.

  3. ``-method gmixture``

     |gmixture| - It also needs cluster number as input
     (``-ncluster <int>``).
     Therefore, one should know beforehand how many cluster is there in data.
     To automatically determine the cluster number, see :ref:`cmdline:-cmetric \<keyword\>`
     For more details about k-means method, see |gmixture-detail|.

******

``-nfeature <int>``
~~~~~~~~~~~~~~~~~~~

Number of features to be read from :ref:`cmdline:-feat [\<.xvg\>]` file.

If file contains less than requested number of features, all features will be read.


******


``-cmetric <keyword>``
~~~~~~~~~~~~~~~~~~~~~~~~~~

Cluster metric to determine the total number of cluster automatically,
particularly for k-means and Gaussian-mixture model.

.. note:: All the cluster metrics are only applicable when ``-method kmeans`` or
          ``-method gmixture`` is used.

Presently following cluster metrics are implemented:
  1. ``-cmetric prior``

     If clusters count is known beforehand, use this with ``-ncluster <int>``.
     Here, ``-ncluster`` takes input as the clusters count.

  2. ``-cmetric rmsd``

     Root Mean Square deviation between central structures of clusters. It uses
     :ref:`cmdline:-crmsthres \<real\>` option for RMSD
     threshold/cutoff.

     .. note:: It requires trajectory file as input.
               Otherwise, ``-cmetric ssr-sst`` will be used for cluster metric with
               default :ref:`cmdline:-ssrchange \<real\>` value.

  3. ``-cmetric ssr-sst``

     It is SSR/SST ratio and used for |elbow|. It is the threshold in relative
     change in SSR/SST ratio in percentage.

  4. ``-cmetric pFS``

     Psuedo F-statatics determined from SSR/SST ratio. Clusters count with
     highest value is considered.

  5. ``-cmetric DBI``

     |DBI|. Lowest value is considered.



******


``-ncluster <int>``
~~~~~~~~~~~~~~~~~~~

It takes the number of clusters. Its usage depends on :ref:`cmdline:-cmetric \<keyword\>`.


.. note:: It is only applicable when ``-method kmeans`` or ``-method gmixture``
          is used.

Conditions:
  1. For ``-cmetric prior``, it is considered as the number clusters to be generated.

  2. For ``-cmetric rmsd``, it is considered as largest number of clusters to
     be generated and iteratively number of clusters are reduced to check whether
     RMSD between central structures are **not** below RMSD threshold
     (:ref:`cmdline:-crmsthres \<real\>`).

  3. For ``-cmetric ssr-sst``, ``-cmetric pFS`` and ``-cmetric DBI``, it is
     considered as maximum number of clusters to generated. At first, two
     clusters are generated and iteratively number of clusters are increased by
     one. When maximum number of clusters is reached, these three cluster-metrics
     are calculated and finally, number of clusters is selected.

******

``-crmsthres <real>``
~~~~~~~~~~~~~~~~~~~~~

RMSD (nm) threshold between central structures for RMSD cluster metric method.

It is used with ``-cmetric rmsd``. In each iteration, RMSD between all central
structures are calculated. If any RMSD value is within the input RMSD (nm)
threshold, number of clusters is decreased by one in next iteration.

It is assumed that when RMSD between two central structures are within the threshold,
central structures are similar enough to merge the two clusters as a single cluster.
However, it is **not** necessary that these two clusters will merge in next iteration.

******

``-ssrchange <real>``
~~~~~~~~~~~~~~~~~~~~~
Threshold relative percentage change in SSR/SST ratio to choose number of clusters
automatically. This threshold gives potential position of Elbow in |elbow|.

.. note::This option is only used when ``-cmetric ssr-sst`` is provided as input.

******

``-db_eps <real>``
~~~~~~~~~~~~~~~~~~~~~

The maximum distance between two samples for them to be considered as in the
same neighborhood.

.. seealso: `scikit-learn DBSCAN class <http://scikit-learn.org/stable/modules/generated/sklearn.cluster.DBSCAN.html#sklearn.cluster.DBSCAN>`_

******

``-db_min_samples <int>``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The number of samples (or total weight) in a neighborhood for a point to be
considered as a core point. This includes the point
itself.

.. seealso: `scikit-learn DBSCAN class <http://scikit-learn.org/stable/modules/generated/sklearn.cluster.DBSCAN.html#sklearn.cluster.DBSCAN>`_

******

``-nminfr <int>``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Number of minimum frames in a cluster to output it as trajectory. If number
of frames is less than this number, the cluster will be ignored.

******

``-[no]fit``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Enable fitting and superimposition of the atoms groups different from RMSD/clustering
group before RMSD calculation.
If Enabled, index group for fitting will be prompted. Otherwise, fitting will be
performed with RMSD/clustering group.

******

``-[no]fit2central``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Enable/Disable trajectory superimposition or fitting to central structure in
the output trajectory. Atoms group used for fitting depends on ``-[no]fit``
option. If ``-nofit``, second input index group (RMSD/clustering group) will
be used for fitting otherwise third index group will be used for fitting.

******

``-sort <keyword>``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Sort trajectory according to these values.

Accepted methods are:
  * ``-sort rmsd``

    Sort trajectory according to RMSD with respect to central structure. Therefore,
    obtained trajectory's first frame will be central structure and RMSD will increase
    gradually after first frame.

  * ``-sort features``

    Sort trajectory according to features sub-space. Distance of each conformation
    to respective central structure is calculated in feature-space and Trajectory
    is written from lowest to highest distance. In this trajectory, first frame
    will be central structure.

    This option is very useful when features are other than PCA's projections of
    eigenvector.

  * ``-sort user``

    Sort trajectory using values supplied by user. Not yet implemented.

******

``-plot <string>``
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

To plot features with clusters in this file.

Plot is generated where feature-vs-feature are depicted with different clusters
as colors. It is helpful in checking whether number of clusters is enough.
